name: CI

on:
  push:
    branches: [master]
  pull_request:
    branches: [master]

jobs:
  test-user-service:
    name: Test user-service
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: services/user-service
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: npm
          cache-dependency-path: services/user-service/package-lock.json
      - run: npm ci
      - run: npm test -- --forceExit

  test-asset-service:
    name: Test asset-service
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: services/asset-service
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: npm
          cache-dependency-path: services/asset-service/package-lock.json
      - run: npm ci
      - run: npm test -- --forceExit

  test-liability-service:
    name: Test liability-service
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: services/liability-service
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: npm
          cache-dependency-path: services/liability-service/package-lock.json
      - run: npm ci
      - run: npm test -- --forceExit

  test-networth-service:
    name: Test networth-service
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: services/networth-service
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: npm
          cache-dependency-path: services/networth-service/package-lock.json
      - run: npm ci
      - run: npm test -- --forceExit

  test-document-service:
    name: Test document-service
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: services/document-service
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: npm
          cache-dependency-path: services/document-service/package-lock.json
      - run: npm ci
      - run: npm test -- --forceExit

  test-service-service:
    name: Test service-service
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: services/service-service
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: npm
          cache-dependency-path: services/service-service/package-lock.json
      - run: npm ci
      - run: npm test -- --forceExit

  all-tests-passed:
    name: All tests passed
    runs-on: ubuntu-latest
    needs:
      - test-user-service
      - test-asset-service
      - test-liability-service
      - test-networth-service
      - test-document-service
      - test-service-service
    steps:
      - run: echo "All 6 services passed CI"
